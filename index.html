<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Saved Reels Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden;
    }

    header {
      padding: 12px;
      background: #111;
      text-align: center;
      z-index: 2;
      position: relative;
    }

    input {
      color: white;
    }

    /* === LAYOUT === */
    #app {
      height: calc(100vh - 50px);
      display: grid;
      grid-template-columns: minmax(60px, 1fr) auto minmax(60px, 1fr);
      align-items: center;
    }

    #reels {
      display: flex;
      justify-content: center;
      pointer-events: none;
    }

    .reel {
      pointer-events: auto;
      width: min(520px, 92vw);
      padding: 14px;
      box-sizing: border-box;
    }

    .reel-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .reel-date {
      font-size: 12px;
      color: #aaa;
      margin-bottom: 8px;
    }

    .open-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 8px 12px;
      background: #3897f0;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
    }

    /* === NAV ZONES === */
    .nav-zone {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
    }

    .arrow {
      font-size: 44px;
      opacity: 0.4;
      transition: transform 0.25s ease, opacity 0.25s ease;
    }

    .nav-zone:hover .arrow {
      opacity: 0.9;
    }

    .nav-zone.swipe-left .arrow {
      transform: translateX(-14px);
    }

    .nav-zone.swipe-right .arrow {
      transform: translateX(14px);
    }
  </style>
</head>
<body>

  <header>
    <div>Instagram Saved Reels</div>
    <input type="file" id="jsonFileInput" accept=".json" />
  </header>

  <div id="app">
    <div class="nav-zone" id="leftZone">
      <div class="arrow">‹</div>
    </div>

    <div id="reels"></div>

    <div class="nav-zone" id="rightZone">
      <div class="arrow">›</div>
    </div>
  </div>

  <script>
    const input = document.getElementById("jsonFileInput");
    const container = document.getElementById("reels");
    const leftZone = document.getElementById("leftZone");
    const rightZone = document.getElementById("rightZone");

    let reels = [];
    let index = 0;

    input.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = evt => {
        const json = JSON.parse(evt.target.result);
        if (!json.saved_saved_media) {
          alert("Invalid Instagram JSON");
          return;
        }
        reels = json.saved_saved_media;
        index = 0;
        render();
      };
      reader.readAsText(file);
    });

    function render() {
      container.innerHTML = "";
      renderReel(index);
      loadInstagram();
    }

    function renderReel(i) {
      const r = reels[i];
      if (!r) return;

      const el = document.createElement("div");
      el.className = "reel";

      const title = document.createElement("div");
      title.className = "reel-title";
      title.textContent = r.title;

      const date = document.createElement("div");
      date.className = "reel-date";
      date.textContent =
        "Saved on: " +
        new Date(r.string_map_data["Saved on"].timestamp * 1000).toLocaleString();

      const block = document.createElement("blockquote");
      block.className = "instagram-media";
      block.setAttribute("data-instgrm-permalink", r.string_map_data["Saved on"].href);
      block.setAttribute("data-instgrm-version", "14");

      const a = document.createElement("a");
      a.href = r.string_map_data["Saved on"].href;
      block.appendChild(a);

      const open = document.createElement("a");
      open.href = r.string_map_data["Saved on"].href;
      open.target = "_blank";
      open.className = "open-btn";
      open.textContent = "Open on Instagram";

      el.append(title, date, block, open);
      container.appendChild(el);
    }

    function loadInstagram() {
      if (!window.instgrm) {
        const s = document.createElement("script");
        s.src = "https://www.instagram.com/embed.js";
        s.async = true;
        document.body.appendChild(s);
      } else {
        window.instgrm.Embeds.process();
      }
    }

    /* === SWIPE + ARROW FEEDBACK === */
    let startX = 0;

    document.addEventListener("pointerdown", e => {
      startX = e.clientX;
    });

    document.addEventListener("pointerup", e => {
      const delta = e.clientX - startX;
      if (Math.abs(delta) < 50) return;

      if (delta < 0 && index < reels.length - 1) {
        index = Math.floor(Math.random() * reels.length);
        leftZone.classList.add("swipe-right");
        render();
      }

      if (delta > 0 && index > 0) {
        index--;
        rightZone.classList.add("swipe-left");
        render();
      }

      setTimeout(() => {
        rightZone.classList.remove("swipe-left");
        leftZone.classList.remove("swipe-right");
      }, 200);
    });
  </script>

</body>
</html>
